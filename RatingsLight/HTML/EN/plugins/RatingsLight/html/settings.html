[% IF useExtJS; extJsScripts = BLOCK %]
<script TYPE="text/javascript">
function manimport() {
	function sleep(ms) {
  		return new Promise(resolve => setTimeout(resolve, ms));
	}
	let proceed = confirm("[% "PLUGIN_RATINGSLIGHT_MANUAL_IMPORT_WARNING" |string %]");

	if (proceed === true) {
		const url = "http://"+window.location.host+"/jsonrpc.js";
		const rawdata = {"id":1,"method":"slim.request","params":["",["ratingslight","manualimport"]]};
		let data = JSON.stringify(rawdata);

		fetch(url, {
			method: "post",
			headers: { "Content-Type": "application/json", "Origin": window.location.hostname },
			body: data
		})
			.then(resp => {
				if (resp.status === 200) {
					console.log("success");
				} else {
					console.log("Status: " + resp.status)
				}
			})
		document.getElementById("importstatus").innerHTML = "Importing...";
		sleep([% prefs.exectime_import %]).then(() => { document.getElementById("importstatus").innerHTML = ""; });
	}
}
function exportplayliststofiles() {
	function sleep(ms) {
  		return new Promise(resolve => setTimeout(resolve, ms));
	}
	let proceed = confirm("[% "PLUGIN_RATINGSLIGHT_EXPORT_PLAYLISTS_TO_FILES_WARNING" |string %]");

	if (proceed === true) {
		const url = "http://"+window.location.host+"/jsonrpc.js";
		const rawdata = {"id":1,"method":"slim.request","params":["",["ratingslight","exportplayliststofiles"]]};
		let data = JSON.stringify(rawdata);

		fetch(url, {
			method: "post",
			headers: { "Content-Type": "application/json", "Origin": window.location.hostname },
			body: data
		})
			.then(resp => {
				if (resp.status === 200) {
					console.log("success");
				} else {
					console.log("Status: " + resp.status)
				}
			})
		document.getElementById("exportstatus").innerHTML = "Exporting...";
		sleep([% prefs.exectime_export %]).then(() => { document.getElementById("exportstatus").innerHTML = ""; });
	}
}
</script>
[% END; END %]

[% PROCESS settings/header.html %]
[% WRAPPER setting title="PLUGIN_RATINGSLIGHT" desc="" %]
[% "PLUGIN_RATINGSLIGHT_DESC" | string %][% END %]
<hr><br>

[% WRAPPER setting title="Menus" desc="" %]
[% WRAPPER setting title="PLUGIN_RATINGSLIGHT_SHOW_RATED_TRACKS_MENUS" desc="PLUGIN_RATINGSLIGHT_SHOW_RATED_TRACKS_MENUS_DESC" %]
<select name="pref_showratedtracksmenus" id="showratedtracksmenus">
	<option value="2" [% IF prefs.showratedtracksmenus.value == 2 %]selected[% END %]>[% "PLUGIN_RATINGSLIGHT_SHOW_RATED_TRACKS_MENUS_HIGH" | string %]</option>
	<option value="1" [% IF prefs.showratedtracksmenus.value == 1 %]selected[% END %]>[% "PLUGIN_RATINGSLIGHT_SHOW_RATED_TRACKS_MENUS_RATED_ONLY" | string %]</option>
	<option value="0" [% IF NOT prefs.showratedtracksmenus %]selected[% END %]>[% "PLUGIN_RATINGSLIGHT_SHOW_RATED_TRACKS_MENUS_DISABLE" | string %]</option>
</select>
[% END %]
<br>

[% WRAPPER setting title="PLUGIN_RATINGSLIGHT_AUTOREBUILD_VLS_AFTER_RATING_CHANGE" desc="PLUGIN_RATINGSLIGHT_AUTOREBUILD_VLS_AFTER_RATING_CHANGE_DESC" %]
<select name="pref_autorebuildvirtualibraryafterrating" id="autorebuildvirtualibraryafterrating">
	<option value="1" [% IF prefs.autorebuildvirtualibraryafterrating %]selected[% END %]>[% "Yes" | string %]</option>
	<option value="0" [% IF NOT prefs.autorebuildvirtualibraryafterrating %]selected[% END %]>[% "No" | string %]</option>
</select>
[% END %]
[% END %]
<hr><br>

[% WRAPPER setting title="Export Ratings" desc="" %]
[% WRAPPER setting title="PLUGIN_RATINGSLIGHT_EXPORT_PLAYLISTS_TO_FILES" desc="PLUGIN_RATINGSLIGHT_EXPORT_PLAYLISTS_TO_FILES_DESC" %]
<div><a href="#" onclick='exportplayliststofiles();'>[% "PLUGIN_RATINGSLIGHT_EXPORT_PLAYLISTS_TO_FILES_LINK" | string %]</a> <span style="color:red;padding-left:15px;font-weight:600;" id="exportstatus"></span></div>
[% END %]
<br>

[% WRAPPER setting title="PLUGIN_RATINGSLIGHT_EXPORT_PLAYLISTS_ONLY_DIFF" desc="PLUGIN_RATINGSLIGHT_EXPORT_PLAYLISTS_ONLY_DIFF_DESC" %]
<select name="pref_onlyratingnotmatchcommenttag" id="onlyratingnotmatchcommenttag">
	<option value="1" [% IF prefs.onlyratingnotmatchcommenttag %]selected[% END %]>[% "Yes" | string %]</option>
	<option value="0" [% IF NOT prefs.onlyratingnotmatchcommenttag %]selected[% END %]>[% "No" | string %]</option>
</select>
[% END %]
[% END %]
<hr><br>

[% WRAPPER setting title="Import Ratings" desc="" %]
[% WRAPPER setting title="PLUGIN_RATINGSLIGHT_RATING_KEYWORD" desc="PLUGIN_RATINGSLIGHT_RATING_KEYWORD_DESC" %]
<br>
<table width="50%">
	<tr>
		<th style="text-align:center;"><b>Rating Keyword <u>Pre</u>fix</b></th>
		<th style="text-align:center;"><b>Rating Keyword <u>Suf</u>fix</b></th>
	</tr>
	<tr>
		<th style="height:4px;" colspan="2"></th>
	</tr>
	<tr>
		<th><input style="text-align:center;" type="text" name="pref_rating_keyword_prefix" id="rating_keyword_prefix" value="[% prefs.rating_keyword_prefix %]" size="40"></th>
		<th><input style="text-align:center;" type="text" name="pref_rating_keyword_suffix" id="rating_keyword_suffix" value="[% prefs.rating_keyword_suffix %]" size="40"></th>
	</tr>
</table>
<br><br>
<b>Example:</b><br><b>pre</b>fix = favstars, <b>suffix</b> = afx: if comment tag contains "favstars<b>4</b>afx" -> rating = <b>4</b> stars
[% END %]
<br>

[% WRAPPER setting title="PLUGIN_RATINGSLIGHT_AUTOSCAN" desc="PLUGIN_RATINGSLIGHT_AUTOSCAN_DESC" %]
<select name="pref_autoscan" id="autoscan">
	<option value="1" [% IF prefs.autoscan %]selected[% END %]>[% "Yes" | string %]</option>
	<option value="0" [% IF NOT prefs.autoscan %]selected[% END %]>[% "No" | string %]</option>
</select>
[% END %]
<br>

[% WRAPPER setting title="PLUGIN_RATINGSLIGHT_MANUAL_IMPORT" desc="" %]
<div><a href="#" onclick='manimport();'>[% "PLUGIN_RATINGSLIGHT_MANUAL_IMPORT_LINK" | string %]</a> <span style="color:red;padding-left:15px;font-weight:600;" id="importstatus"></span></div>
[% END %]
[% END %]
[% PROCESS settings/footer.html %]
